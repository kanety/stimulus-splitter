{"version":3,"file":"index.js","sources":["../src/store.js","../src/index.js"],"sourcesContent":["export default class Store {\n  constructor(controller) {\n    this.controller = controller;\n  }\n\n  get key() {\n    return this.controller.storeKeyValue;\n  }\n\n  get splitters() {\n    return this.controller.splitters;\n  }\n\n  load() {\n    if (!this.key) return;\n\n    let data = this.constructor.load(this.key);\n    if (!data) return;\n\n    this.splitters.forEach(splitter => {\n      let sizes = data[this.controller.getID(splitter)];\n      let panes = this.controller.panes(splitter);\n      if (this.controller.isVertical(splitter)) {\n        this.controller.setWidth(panes, sizes[0][0], sizes[1][0]);\n      } else {\n        this.controller.setHeight(panes, sizes[0][1], sizes[1][1]);\n      }\n    });\n  }\n\n  save() {\n    if (!this.key) return;\n\n    let data = {};\n    this.splitters.forEach(splitter => {\n      let panes = this.controller.panes(splitter);\n      data[this.controller.getID(splitter)] = panes.map(pane => [pane.offsetWidth, pane.offsetHeight]);\n    });\n    this.constructor.save(this.key, data);\n  }\n\n  static load(key) {\n    let json = sessionStorage.getItem(key);\n    try {\n      return JSON.parse(json)\n    } catch {\n      return null;\n    }\n  }\n\n  static save(key, value) {\n    try {\n      sessionStorage.setItem(key, JSON.stringify(value));\n    } catch(error) {\n      console.error(error);\n    }\n  }\n}\n","import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport Store from './store';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    resizeTarget: String,\n    storeKey: String\n  };\n  static actions = [\n    ['element', 'mousedown@document->start'],\n    ['element', 'touchstart@document->start']\n  ];\n  static dragActions = [\n    ['element', 'mousemove@document->move'],\n    ['element', 'touchmove@document->move'],\n    ['element', 'mouseup@document->end'],\n    ['element', 'touchend@document->end'],\n    ['element', 'selectstart@document->prevent']\n  ];\n\n  get splitters() {\n    return this.scope.findAllElements('[data-splitter-id]');\n  }\n\n  initialize() {\n    this.store = new Store(this);\n  }\n\n  connect() {\n    this.store.load();\n  }\n\n  start(e) {\n    this.splitter = this.splitters.find(splitter => splitter == e.target);\n    if (!this.splitter) return;\n\n    this.startPos = this.pagePos(e);\n    this.startSizes = this.panes(this.splitter).map(pane => this.paneSize(pane));\n\n    this.toggleClass(this.splitter, true);\n    this.disableIframe(true);\n    this.context.actionSet.add(this.constructor.dragActions);\n  }\n\n  move(e) {\n    let pos = this.pagePos(e);\n    let panes = this.panes(this.splitter);\n\n    if (this.isVertical(this.splitter)) {\n      this.resizeWidth(panes, pos);\n    } else {\n      this.resizeHeight(panes, pos);\n    }\n  }\n\n  end(e) {\n    this.toggleClass(this.splitter, false);\n    this.disableIframe(false);\n    this.context.actionSet.remove(this.constructor.dragActions);\n\n    this.dispatch('resized', { detail: { splitter: this.splitter }});\n    this.splitter = null;\n    this.store.save();\n  }\n\n  prevent(e) {\n    e.preventDefault();\n  }\n\n  pagePos(e) {\n    return {\n      x: e.changedTouches ? e.changedTouches[0].pageX : e.pageX,\n      y: e.changedTouches ? e.changedTouches[0].pageY : e.pageY\n    };\n  }\n\n  panes(splitter) {\n    if (this.element.matches('table')) {\n      let parent = splitter.closest('th,td');\n      return [parent.previousElementSibling, parent];\n    } else {\n      return [splitter.previousElementSibling, splitter.nextElementSibling]\n    }\n  }\n\n  paneSize(pane) {\n    return { width: pane.offsetWidth, height: pane.offsetHeight };\n  }\n\n  isVertical(splitter) {\n    return this.element.matches('table') || splitter.parentNode.matches('.st-splitter-vertical');\n  }\n\n  resizeWidth(panes, pos) {\n    let width1 = this.startSizes[0].width + (pos.x - this.startPos.x);\n    let width2 = this.startSizes[1].width - (pos.x - this.startPos.x);\n    this.setWidth(panes, width1, width2);\n  }\n\n  resizeHeight(panes, pos) {\n    let height1 = this.startSizes[0].height + (pos.y - this.startPos.y);\n    let height2 = this.startSizes[1].height - (pos.y - this.startPos.y);\n    this.setHeight(panes, height1, height2);\n  }\n\n  setWidth(panes, width1, width2) {\n    if (this.resizeTargetValue == 'both') {\n      if (width1 > 0 && width2 > 0) {\n        panes[0].style.width = width1 + 'px';\n        panes[1].style.width = width2 + 'px';\n      }\n    } else {\n      if (width1 > 0) {\n        panes[0].style.width = width1 + 'px';\n      }\n    }\n  }\n\n  setHeight(panes, height1, height2) {\n    if (this.resizeTargetValue == 'both') {\n      if (height1 > 0 && height2 > 0) {\n        panes[0].style.height = height1 + 'px';\n        panes[1].style.height = height2 + 'px';\n      }\n    } else {\n      if (height1 > 0) {\n        panes[0].style.height = height1 + 'px';\n      }\n    }\n  }\n\n  toggleClass(splitter, dragging) {\n    if (dragging) {\n      splitter.classList.add('st-splitter--dragging');\n    } else {\n      splitter.classList.remove('st-splitter--dragging');\n    }\n  }\n\n  getID(splitter) {\n    return splitter.getAttribute('data-splitter-id');\n  }\n\n  disableIframe(disabled) {\n    document.querySelectorAll('iframe').forEach(iframe => {\n      iframe.style.pointerEvents = disabled ? 'none' : '';\n    })\n  }\n}\n"],"names":["Store","constructor","controller","this","key","storeKeyValue","splitters","load","data","forEach","splitter","sizes","getID","panes","isVertical","setWidth","setHeight","save","map","pane","offsetWidth","offsetHeight","static","json","sessionStorage","getItem","JSON","parse","value","setItem","stringify","error","console","Controller","scope","findAllElements","initialize","store","connect","start","e","find","target","startPos","pagePos","startSizes","paneSize","toggleClass","disableIframe","context","actionSet","add","dragActions","move","pos","resizeWidth","resizeHeight","end","remove","dispatch","detail","prevent","preventDefault","x","changedTouches","pageX","y","pageY","element","matches","parent","closest","previousElementSibling","nextElementSibling","width","height","parentNode","width1","width2","resizeTargetValue","style","height1","height2","dragging","classList","getAttribute","disabled","document","querySelectorAll","iframe","pointerEvents","values","resizeTarget","String","storeKey","actions"],"mappings":"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"}