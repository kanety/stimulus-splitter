{"version":3,"file":"index.umd.js","sources":["../src/store.js","../src/index.js"],"sourcesContent":["export default class Store {\n  constructor(controller) {\n    this.controller = controller;\n  }\n\n  get key() {\n    return this.controller.storeKeyValue;\n  }\n\n  get splitters() {\n    return this.controller.splitters;\n  }\n\n  load() {\n    if (!this.key) return;\n\n    let data = this.constructor.load(this.key);\n    if (!data) return;\n\n    this.splitters.forEach(splitter => {\n      let sizes = data[this.controller.getID(splitter)];\n      let panes = this.controller.panes(splitter);\n      panes.forEach((pane, i) => {\n        if (this.controller.isVertical(splitter)) {\n          pane.style.width = sizes[i][0] + 'px';\n        } else {\n          pane.style.height = sizes[i][1] + 'px';\n        }\n      });\n    });\n  }\n\n  save() {\n    if (!this.key) return;\n\n    let data = {};\n    this.splitters.forEach(splitter => {\n      let panes = this.controller.panes(splitter);\n      data[this.controller.getID(splitter)] = panes.map(pane => [pane.offsetWidth, pane.offsetHeight]);\n    });\n    this.constructor.save(this.key, data);\n  }\n\n  static load(key) {\n    let json = sessionStorage.getItem(key);\n    try {\n      return JSON.parse(json)\n    } catch {\n      return null;\n    }\n  }\n\n  static save(key, value) {\n    sessionStorage.setItem(key, JSON.stringify(value));\n  }\n}\n","import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport Store from './store';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    updateTarget: String,\n    storeKey: String\n  };\n  static actions = [\n    ['element', 'mousedown@document->start'],\n    ['element', 'touchstart@document->start']\n  ];\n  static dragActions = [\n    ['element', 'mousemove@document->move'],\n    ['element', 'touchmove@document->move'],\n    ['element', 'mouseup@document->end'],\n    ['element', 'touchend@document->end'],\n    ['element', 'selectstart@document->prevent']\n  ];\n\n  get splitters() {\n    return this.scope.findAllElements('[data-splitter-id]');\n  }\n\n  initialize() {\n    this.store = new Store(this);\n  }\n\n  connect() {\n    this.store.load();\n  }\n\n  start(e) {\n    this.splitter = this.splitters.find(splitter => splitter == e.target);\n    if (!this.splitter) return;\n\n    this.startPos = this.pagePos(e);\n    this.startSizes = this.panes(this.splitter).map(pane => this.paneSize(pane));\n\n    this.toggleClass(this.splitter, true);\n    this.disableIframe(true);\n    this.context.actionSet.add(this.constructor.dragActions);\n  }\n\n  move(e) {\n    let pos = this.pagePos(e);\n    let panes = this.panes(this.splitter);\n\n    if (this.isVertical(this.splitter)) {\n      this.updateWidth(panes, pos);\n    } else {\n      this.updateHeight(panes, pos);\n    }\n  }\n\n  end(e) {\n    this.toggleClass(this.splitter, false);\n    this.disableIframe(false);\n    this.context.actionSet.remove(this.constructor.dragActions);\n\n    this.dispatch('resized', { detail: { splitter: this.splitter }});\n    this.splitter = null;\n    this.store.save();\n  }\n\n  prevent(e) {\n    e.preventDefault();\n  }\n\n  pagePos(e) {\n    return {\n      x: e.changedTouches ? e.changedTouches[0].pageX : e.pageX,\n      y: e.changedTouches ? e.changedTouches[0].pageY : e.pageY\n    };\n  }\n\n  panes(splitter) {\n    if (this.element.matches('table')) {\n      let parent = splitter.closest('th,td');\n      return [parent.previousElementSibling, parent];\n    } else {\n      return [splitter.previousElementSibling, splitter.nextElementSibling]\n    }\n  }\n\n  paneSize(pane) {\n    return { width: pane.offsetWidth, height: pane.offsetHeight };\n  }\n\n  isVertical(splitter) {\n    return this.element.matches('table') || splitter.parentNode.matches('.st-splitter-vertical');\n  }\n\n  updateWidth(panes, pos) {\n    let width1 = this.startSizes[0].width + (pos.x - this.startPos.x);\n    let width2 = this.startSizes[1].width - (pos.x - this.startPos.x);\n    if (this.updateTargetValue == 'both') {\n      if (width1 > 0 && width2 > 0) {\n        panes[0].style.width = width1 + 'px';\n        panes[1].style.width = width2 + 'px';\n      }\n    } else {\n      if (width1 > 0) {\n        panes[0].style.width = width1 + 'px';\n      }\n    }\n  }\n\n  updateHeight(panes, pos) {\n    let height1 = this.startSizes[0].height + (pos.y - this.startPos.y);\n    let height2 = this.startSizes[1].height - (pos.y - this.startPos.y);\n    if (this.updateTargetValue == 'both') {\n      if (height1 > 0 && height2 > 0) {\n        panes[0].style.height = height1 + 'px';\n        panes[1].style.height = height2 + 'px';\n      }\n    } else {\n      if (height1 > 0) {\n        panes[0].style.height = height1 + 'px';\n      }\n    }\n  }\n\n  toggleClass(splitter, dragging) {\n    if (dragging) {\n      splitter.classList.add('st-splitter--dragging');\n    } else {\n      splitter.classList.remove('st-splitter--dragging');\n    }\n  }\n\n  getID(splitter) {\n    return splitter.getAttribute('data-splitter-id');\n  }\n\n  disableIframe(disabled) {\n    document.querySelectorAll('iframe').forEach(iframe => {\n      iframe.style.pointerEvents = disabled ? 'none' : '';\n    })\n  }\n}\n"],"names":["Store","constructor","controller","this","key","storeKeyValue","splitters","load","data","forEach","splitter","sizes","getID","panes","pane","i","isVertical","style","width","height","save","map","offsetWidth","offsetHeight","static","json","sessionStorage","getItem","JSON","parse","value","setItem","stringify","Controller","scope","findAllElements","initialize","store","connect","start","e","find","target","startPos","pagePos","startSizes","paneSize","toggleClass","disableIframe","context","actionSet","add","dragActions","move","pos","updateWidth","updateHeight","end","remove","dispatch","detail","prevent","preventDefault","x","changedTouches","pageX","y","pageY","element","matches","parent","closest","previousElementSibling","nextElementSibling","parentNode","width1","width2","updateTargetValue","height1","height2","dragging","classList","getAttribute","disabled","document","querySelectorAll","iframe","pointerEvents","values","updateTarget","String","storeKey","actions"],"mappings":"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"}