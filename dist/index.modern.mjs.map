{"version":3,"file":"index.modern.mjs","sources":["../src/store.js","../src/index.js"],"sourcesContent":["export default class Store {\n  constructor(controller) {\n    this.controller = controller;\n  }\n\n  get key() {\n    return this.controller.storeKeyValue;\n  }\n\n  get splitters() {\n    return this.controller.splitters;\n  }\n\n  load() {\n    if (!this.key) return;\n\n    let data = this.constructor.load(this.key);\n    if (!data) return;\n\n    this.splitters.forEach(splitter => {\n      let sizes = data[this.controller.getID(splitter)];\n      let panes = this.controller.panes(splitter);\n      if (this.controller.isVertical(splitter)) {\n        this.controller.setWidth(panes, sizes[0][0], sizes[1][0]);\n      } else {\n        this.controller.setHeight(panes, sizes[0][1], sizes[1][1]);\n      }\n    });\n  }\n\n  save() {\n    if (!this.key) return;\n\n    let data = {};\n    this.splitters.forEach(splitter => {\n      let panes = this.controller.panes(splitter);\n      data[this.controller.getID(splitter)] = panes.map(pane => [pane.offsetWidth, pane.offsetHeight]);\n    });\n    this.constructor.save(this.key, data);\n  }\n\n  static load(key) {\n    let json = sessionStorage.getItem(key);\n    try {\n      return JSON.parse(json)\n    } catch {\n      return null;\n    }\n  }\n\n  static save(key, value) {\n    try {\n      sessionStorage.setItem(key, JSON.stringify(value));\n    } catch(error) {\n      console.error(error);\n    }\n  }\n}\n","import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport Store from './store';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    resizeTarget: String,\n    storeKey: String\n  };\n  static actions = [\n    ['element', 'mousedown@document->start'],\n    ['element', 'touchstart@document->start']\n  ];\n  static dragActions = [\n    ['element', 'mousemove@document->move'],\n    ['element', 'touchmove@document->move'],\n    ['element', 'mouseup@document->end'],\n    ['element', 'touchend@document->end'],\n    ['element', 'selectstart@document->prevent']\n  ];\n\n  get splitters() {\n    return this.scope.findAllElements('[data-splitter-id]');\n  }\n\n  initialize() {\n    this.store = new Store(this);\n  }\n\n  connect() {\n    this.store.load();\n  }\n\n  start(e) {\n    this.splitter = this.splitters.find(splitter => splitter == e.target);\n    if (!this.splitter) return;\n\n    this.startPos = this.pagePos(e);\n    this.startSizes = this.panes(this.splitter).map(pane => this.paneSize(pane));\n\n    this.toggleClass(this.splitter, true);\n    this.disableIframe(true);\n    this.context.actionSet.add(this.constructor.dragActions);\n  }\n\n  move(e) {\n    let pos = this.pagePos(e);\n    let panes = this.panes(this.splitter);\n\n    if (this.isVertical(this.splitter)) {\n      this.resizeWidth(panes, pos);\n    } else {\n      this.resizeHeight(panes, pos);\n    }\n  }\n\n  end(e) {\n    this.toggleClass(this.splitter, false);\n    this.disableIframe(false);\n    this.context.actionSet.remove(this.constructor.dragActions);\n\n    this.dispatch('resized', { detail: { splitter: this.splitter }});\n    this.splitter = null;\n    this.store.save();\n  }\n\n  prevent(e) {\n    e.preventDefault();\n  }\n\n  pagePos(e) {\n    return {\n      x: e.changedTouches ? e.changedTouches[0].pageX : e.pageX,\n      y: e.changedTouches ? e.changedTouches[0].pageY : e.pageY\n    };\n  }\n\n  panes(splitter) {\n    if (this.element.matches('table')) {\n      let parent = splitter.closest('th,td');\n      return [parent.previousElementSibling, parent];\n    } else {\n      return [splitter.previousElementSibling, splitter.nextElementSibling]\n    }\n  }\n\n  paneSize(pane) {\n    return { width: pane.offsetWidth, height: pane.offsetHeight };\n  }\n\n  isVertical(splitter) {\n    return this.element.matches('table') || splitter.parentNode.matches('.st-splitter-vertical');\n  }\n\n  resizeWidth(panes, pos) {\n    let width1 = this.startSizes[0].width + (pos.x - this.startPos.x);\n    let width2 = this.startSizes[1].width - (pos.x - this.startPos.x);\n    this.setWidth(panes, width1, width2);\n  }\n\n  resizeHeight(panes, pos) {\n    let height1 = this.startSizes[0].height + (pos.y - this.startPos.y);\n    let height2 = this.startSizes[1].height - (pos.y - this.startPos.y);\n    this.setHeight(panes, height1, height2);\n  }\n\n  setWidth(panes, width1, width2) {\n    if (this.resizeTargetValue == 'both') {\n      if (width1 > 0 && width2 > 0) {\n        panes[0].style.width = width1 + 'px';\n        panes[1].style.width = width2 + 'px';\n      }\n    } else {\n      if (width1 > 0) {\n        panes[0].style.width = width1 + 'px';\n      }\n    }\n  }\n\n  setHeight(panes, height1, height2) {\n    if (this.resizeTargetValue == 'both') {\n      if (height1 > 0 && height2 > 0) {\n        panes[0].style.height = height1 + 'px';\n        panes[1].style.height = height2 + 'px';\n      }\n    } else {\n      if (height1 > 0) {\n        panes[0].style.height = height1 + 'px';\n      }\n    }\n  }\n\n  toggleClass(splitter, dragging) {\n    if (dragging) {\n      splitter.classList.add('st-splitter--dragging');\n    } else {\n      splitter.classList.remove('st-splitter--dragging');\n    }\n  }\n\n  getID(splitter) {\n    return splitter.getAttribute('data-splitter-id');\n  }\n\n  disableIframe(disabled) {\n    document.querySelectorAll('iframe').forEach(iframe => {\n      iframe.style.pointerEvents = disabled ? 'none' : '';\n    })\n  }\n}\n"],"names":["Store","constructor","controller","this","key","storeKeyValue","splitters","load","data","forEach","splitter","sizes","getID","panes","isVertical","setWidth","setHeight","save","map","pane","offsetWidth","offsetHeight","json","sessionStorage","getItem","JSON","parse","_unused","value","setItem","stringify","error","console","_Class","Controller","scope","findAllElements","initialize","store","connect","start","e","find","target","startPos","pagePos","startSizes","paneSize","toggleClass","disableIframe","context","actionSet","add","dragActions","move","pos","resizeWidth","resizeHeight","end","remove","dispatch","detail","prevent","preventDefault","x","changedTouches","pageX","y","pageY","element","matches","parent","closest","previousElementSibling","nextElementSibling","width","height","parentNode","width1","width2","resizeTargetValue","style","height1","height2","dragging","classList","getAttribute","disabled","document","querySelectorAll","iframe","pointerEvents","values","resizeTarget","String","storeKey","actions"],"mappings":"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"}